spring:
  # H2 In-Memory Database Configuration for Fast Testing
  datasource:
    url: jdbc:h2:mem:testdb;DB_CLOSE_DELAY=-1;DB_CLOSE_ON_EXIT=FALSE;MODE=PostgreSQL;DATABASE_TO_LOWER=TRUE;DEFAULT_NULL_ORDERING=HIGH
    username: sa
    password: password
    driver-class-name: org.h2.Driver
  
  # JPA Configuration for H2
  jpa:
    hibernate:
      ddl-auto: create-drop  # Auto-create schema for tests
    show-sql: true
    properties:
      hibernate:
        dialect: org.hibernate.dialect.H2Dialect
        format_sql: true
        # Enable H2 compatibility features
        globally_quoted_identifiers: true
        globally_quoted_identifiers_skip_column_definitions: true
  
  # H2 Console (useful for debugging tests)
  h2:
    console:
      enabled: true
      path: /h2-console
  
  # Disable Liquibase for unit tests (use DDL auto-creation instead)
  liquibase:
    enabled: false
  
  # Security Configuration for Tests
  security:
    oauth2:
      resourceserver:
        jwt:
          # Mock JWT configuration for testing
          issuer-uri: http://localhost:9999/realms/test
  
  # Kafka Configuration for Tests (will be overridden by TestContainers when needed)
  kafka:
    bootstrap-servers: localhost:9999  # Dummy value, overridden in integration tests
    consumer:
      group-id: customer-service-test-group
      auto-offset-reset: earliest
    producer:
      key-serializer: org.apache.kafka.common.serialization.StringSerializer
      value-serializer: org.apache.kafka.common.serialization.StringSerializer

# Keycloak Configuration for Tests
keycloak:
  auth-server-url: http://localhost:9999
  realm: test-realm
  resource: customer-management-test
  credentials:
    secret: test-secret

# Eureka Configuration for Tests
eureka:
  client:
    enabled: false  # Disable service discovery in tests
    register-with-eureka: false
    fetch-registry: false

# Server Configuration for Tests
server:
  port: 0  # Random port for tests to avoid conflicts

# Logging Configuration for Tests
logging:
  level:
    com.pdh.customer: DEBUG
    org.springframework.security: DEBUG
    org.hibernate.SQL: DEBUG
    org.hibernate.type.descriptor.sql.BasicBinder: TRACE
    org.testcontainers: INFO
    org.springframework.test: INFO

# Test-specific configurations
test:
  # Mock data configuration
  mock-data:
    enabled: true
    sample-users:
      - user-id: "550e8400-e29b-41d4-a716-446655440001"
        nationality: "Vietnamese"
        preferred-language: "vi"
        preferred-currency: "VND"
      - user-id: "550e8400-e29b-41d4-a716-446655440002"
        nationality: "American"
        preferred-language: "en"
        preferred-currency: "USD"
